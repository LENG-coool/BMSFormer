# Легковесная оценка SOH литиевых батарей для встраиваемых систем: Разработка и применение BMSFormer
## Введение{#введение}
В таких областях, как электромобили и аэрокосмическая промышленность, **оценка состояния здоровья литиевых батарей** имеет решающее значение для обеспечения безопасности системы. Однако существующие системы управления батареями сталкиваются с дилеммой:

- Модели глубокого обучения: хотя способны обеспечить точные прогнозы, их вычислительная сложность слишком высока, что затрудняет их работу на встраиваемых устройствах с ограниченными ресурсами;
- Традиционные модели: хотя вычислительно легковесны, их точность часто неудовлетворительна при работе со сложной нелинейной деградацией батарей.

Недавняя статья, опубликованная в *Energy* под названием ***BMSFormer: An efficient deep learning model for online state-of-health estimation of lithium-ion batteries under high-frequency early SOC data with strong correlated single health indicator***, предлагает легковесную модель глубокого обучения под названием **BMSFormer**, которая предоставляет новое решение для онлайн-мониторинга батарей, балансируя вычислительную эффективность и точность прогнозирования.

## Метод оценки SOH{#метод-soh}
Текущие исследования по оценке SOH сталкиваются с тремя основными проблемами:
- Высокая вычислительная сложность: наложение моделей приводит к избыточным параметрам, что затрудняет адаптацию к аппаратному обеспечению BMS с минимальной памятью.
- Нестабильная точность: ограниченная качеством извлечения индикаторов здоровья, возникают большие ошибки при внезапном восстановлении емкости или сложных условиях эксплуатации.
- Сложная настройка гиперпараметров: производительность модели очень чувствительна к гиперпараметрам, что приводит к плохой устойчивости при реальном развертывании.

В статье используются три основных набора данных батарей от **Оксфордского университета, NASA и Центра передового инжиниринга жизненного цикла Мэрилендского университета** для решения этих проблем с помощью предложенного метода оценки SOH, который включает следующие четыре этапа:

(1) **Сбор данных**: проводятся эксперименты по старению батарей с тремя различными химическими системами в течение полного жизненного цикла при различных протоколах заряда-разряда для оценки предложенной модели.

(2) **Инженерия признаков**: время заряда-разряда постоянным током из каждого цикла извлекается как индикаторы здоровья (*HIs*). Начиная с выбранного интервала, поиск индикаторов здоровья выполняется путем постепенного уменьшения размера окна и шага до тех пор, пока размер окна не достигнет 0,01 В или не будет найден более высокий коэффициент корреляции Пирсона (*PCC*). Затем скользящие окна используются для разделения данных временных рядов индикаторов здоровья на несколько подмножеств, при этом истинное значение SOH следующего временного шага под каждым окном служит меткой для соответствующего подмножества.

(3) **Обучение модели**: для удобства эксперимента Cell1, B0005 и CS2-35 выбираются в качестве обучающих наборов, используя первые 30% данных для обучения при 384 комбинациях гиперпараметров, а остальные 70% для валидации и сравнения для выбора наилучшей модели. Затем оптимальная модель тестируется напрямую на полных данных других батарей в соответствующем наборе данных для оценки способности модели к обобщению, и BMSFormer сравнивается с четырьмя различными моделями глубокого обучения.

(4) **Оценка модели**: различные модели оцениваются по трем параметрам: точность, эффективность и стабильность. Используются четыре типичные метрики оценки для измерения точности, четыре часто используемые метрики вычислительной сложности для оценки эффективности обучения и результаты *R²* из 384 комбинаций гиперпараметров для оценки стабильности результатов обучения.
<img src="/en图片1.png" style="width: 100%; margin: 0 auto; display: block;" />
<p align="center" style="color: grey">Блок-схема разработанного метода оценки SOH</p>

## Модель BMSFormer{#модель-bmsformer}
1. **Общая структура**

Общая структура модели показана на рисунке. Конкретный процесс следующий: используя индикаторы здоровья (HIs) в качестве входных данных, они разделяются на сегменты через сегментацию окон, встраиваются в многомерное пространство и затем подаются в блоки BMSFormer (содержащие модуль LGFA и модуль DSConv-L); выход модуля LGFA транспонируется и затем подается в модуль DSConv-L, после чего выполняется обратная операция транспонирования; наконец, выходы всех блоков BMSFormer подаются в слой многослойного персептрона (MLP) для получения окончательного результата оценки. Во время обучения истинное значение SOH следующего временного шага для каждого сегмента окна служит меткой для направления модели для оптимизации градиентного спуска.
<img src="/en图片2.png" style="width: 100%; margin: 0 auto; display: block;" />
<p align="center" style="color: grey">Диаграмма архитектуры BMSFormer</p>

2. **Локально-глобальное слияние внимания** (LGFA)

Традиционные трансформеры используют внимание Softmax, вычислительная сложность которого растет квадратично с длиной последовательности.

BMSFormer создает модуль LGFA, который снижает сложность до линейного уровня. Он может не только улавливать долгосрочные тенденции деградации, как традиционные модели, но также поддерживать высокую чувствительность к краткосрочным колебаниям и более подходит для быстрых вычислений на мобильных устройствах.

3. **Многомасштабная глубинно-разделимая свертка** (DSConv)

Для дальнейшего обогащения извлечения признаков BMSFormer встраивает два сверточных модуля разных размерностей:
- DSConv-S: свертка с малым ядром, отвечающая за захват детальных признаков.
- DSConv-L: свертка с большим ядром, отвечающая за извлечение долгосрочных зависимостей.

По сравнению со стандартной сверткой этот дизайн значительно сокращает количество параметров и вычислительные затраты, сохраняя разнообразие признаков.
<img src="/en图片3.png" style="width: 100%; margin: 0 auto; display: block;" />
<p align="center" style="color: grey">Диаграмма базовой структуры DSConv</p>

4. **Поиск "единичного индикатора здоровья" с сильной корреляцией**

Авторы извлекают индикаторы здоровья из высокочастотных сегментов SOC во время зарядки (3,8 В-4,2 В) и разрядки (3,8 В-3,4 В) с помощью постепенно уточняемого алгоритма поиска.

Эксперименты показывают, что коэффициент корреляции Пирсона (PCC) между индикаторами, извлеченными этим методом, и SOH батареи в среднем превышает 0,99.

## Экспериментальные результаты{#экспериментальные-результаты}
Путем валидации на трех авторитетных наборах данных **Oxford, NASA и CALCE**, BMSFormer подтверждает свою эффективность в прогнозировании срока службы батареи:

- **Повышенная точность оценки**: на всех наборах данных его метрики ошибок (*MAE* и *RMSE*) являются самыми низкими. По сравнению с традиционными моделями LSTM средняя ошибка снижается на 47%–73%.

- **Высокая степень соответствия**: его оценки *R²* наиболее близки к 1 во всех сценариях (до 0,9934), что доказывает, что его прогнозы наиболее точно соответствуют истинному состоянию здоровья.
<table style="width:100%; border-collapse: collapse; text-align: center;" border="1">
  <thead>
    <tr style="background-color: #f2f2f2;">
      <th>Тип набора данных</th>
      <th>Метрика оценки</th>
      <th><strong>BMSFormer</strong></th>
      <th>CNN-Transformer</th>
      <th>Transformer</th>
      <th>CNN-LSTM</th>
      <th>LSTM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="3"><strong>Oxford</strong><br>(Среднее по 8 ячейкам)</td>
      <td>MAE ↓</td>
      <td><strong>0.0023</strong></td>
      <td>0.0027</td>
      <td>0.0043</td>
      <td>0.0057</td>
      <td>0.0087</td>
    </tr>
    <tr>
      <td>RMSE ↓</td>
      <td><strong>0.0031</strong></td>
      <td>0.0037</td>
      <td>0.0056</td>
      <td>0.0082</td>
      <td>0.0116</td>
    </tr>
    <tr>
      <td>R² ↑</td>
      <td><strong>0.9934</strong></td>
      <td>0.9904</td>
      <td>0.9796</td>
      <td>0.9587</td>
      <td>0.9160</td>
    </tr>
    <tr>
      <td rowspan="3"><strong>NASA & CALCE</strong><br>(Среднее по 8 ячейкам)</td>
      <td>MAE ↓</td>
      <td><strong>0.0102</strong></td>
      <td>0.0163</td>
      <td>0.0134</td>
      <td>0.0179</td>
      <td>0.0197</td>
    </tr>
    <tr>
      <td>RMSE ↓</td>
      <td><strong>0.0143</strong></td>
      <td>0.0219</td>
      <td>0.0177</td>
      <td>0.0242</td>
      <td>0.0268</td>
    </tr>
    <tr>
      <td>R² ↑</td>
      <td><strong>0.9884</strong></td>
      <td>0.9791</td>
      <td>0.9830</td>
      <td>0.9706</td>
      <td>0.9625</td>
    </tr>
  </tbody>
</table>

## Оригинальная ссылка{#оригинальная-ссылка}
[*Li X, Zhao M, Zhong S, et al. BMSFormer: An efficient deep learning model for online state-of-health estimation of lithium-ion batteries under high-frequency early SOC data with strong correlated single health indicator[J]. Energy, 2024, 313(C).*](/BMSFormer.pdf)
